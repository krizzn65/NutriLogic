import{R as e,S as m,r as i,p as G,b as P,P as T,D as I,e as $,I as w,f as j,g as d,ar as z,$ as W,a0 as Y}from"./app-BXoXraSC.js";function K(){return e.createElement("div",{className:"flex flex-col w-full h-full bg-white overflow-x-hidden"},e.createElement("div",{className:"px-4 pt-5 md:px-10 md:pt-10 pb-2 bg-white z-10"},e.createElement("div",{className:"mb-2"},e.createElement(m,{className:"h-9 w-48 mb-2"}),e.createElement(m,{className:"h-5 w-32",variant:"text"})),e.createElement("div",{className:"mt-6 flex flex-col md:flex-row gap-3 items-center justify-between pb-4 border-b border-gray-100"},e.createElement("div",{className:"flex items-center gap-2 w-full md:w-auto"},e.createElement(m,{className:"h-9 w-32 rounded-full"}),e.createElement(m,{className:"h-9 w-32 rounded-full"}),e.createElement(m,{className:"h-9 w-40 rounded-full"})),e.createElement("div",{className:"w-full md:w-auto flex gap-2"},e.createElement(m,{className:"h-9 w-32 rounded-full"}),e.createElement(m,{className:"h-9 w-32 rounded-full"})))),e.createElement("div",{className:"flex-1 overflow-y-auto"},[1,2,3,4,5,6,7,8].map(p=>e.createElement("div",{key:p,className:"bg-white border-b border-gray-100"},e.createElement("div",{className:"px-4 md:px-8 py-4 flex flex-col md:flex-row md:items-center gap-4"},e.createElement("div",{className:"flex items-center gap-4 min-w-[200px]"},e.createElement(m,{className:"w-10 h-10 rounded-full"}),e.createElement("div",null,e.createElement(m,{className:"h-5 w-32 mb-1"}),e.createElement(m,{className:"h-3 w-24"}))),e.createElement("div",{className:"flex-1"},e.createElement(m,{className:"h-4 w-3/4 mb-2"}),e.createElement(m,{className:"h-3 w-1/2"})),e.createElement("div",{className:"text-right min-w-[120px]"},e.createElement(m,{className:"h-4 w-24 mb-1 ml-auto"}),e.createElement(m,{className:"h-3 w-32 ml-auto"})))))))}function Q(){const[p,f]=i.useState(!0),[y,b]=i.useState(null),[u,E]=i.useState([]),[n,N]=i.useState({current_page:1,per_page:10,total:0,last_page:1}),[s,H]=i.useState({child_id:"",type:"all",start_date:"",end_date:""}),[x,v]=i.useState([]),[_,k]=i.useState(null),{getCachedData:C,setCachedData:D}=G(),[L,A]=i.useState(!0);i.useEffect(()=>{F(),g(1)},[]),i.useEffect(()=>{if(L){A(!1);return}g(1)},[s]);const F=async()=>{try{k(null);const t=C("children");if(t){v(t);return}const r=(await P.get("/parent/children")).data.data;v(r),D("children",r)}catch(t){console.error("Error fetching children:",t),k("Gagal memuat daftar anak")}},g=async(t=1)=>{try{f(!0),b(null);const a={page:t,per_page:n.per_page};s.child_id&&(a.child_id=s.child_id),s.type&&s.type!=="all"&&(a.type=s.type),s.start_date&&(a.start_date=s.start_date),s.end_date&&(a.end_date=s.end_date);const r=`history_${JSON.stringify(a)}`,c=C(r);if(c){E(c.data),N(c.meta),f(!1);return}const l=await P.get("/parent/history",{params:a});E(l.data.data),N(l.data.meta),D(r,{data:l.data.data,meta:l.data.meta})}catch(a){const r=a.response?.data?.message||"Gagal memuat riwayat. Silakan coba lagi.";b(r),console.error("History fetch error:",a)}finally{f(!1)}},o=(t,a)=>{H(r=>{const c={...r,[t]:a};if(t==="start_date"&&c.end_date){const l=new Date(a),M=new Date(c.end_date);l>M&&(c.end_date="")}if(t==="end_date"&&c.start_date){const l=new Date(c.start_date);new Date(a)<l&&(c.start_date="")}return c})},h=t=>{g(t)},S=t=>{if(!t)return"";const a=new Date(t),r=["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"];return`${a.getDate()} ${r[a.getMonth()]} ${a.getFullYear()}`},J=t=>{switch(t){case"weighing":return"âš–ï¸";case"meal":return"ðŸ½ï¸";case"immunization":return"ðŸ’‰";default:return"ðŸ“‹"}},O=t=>{switch(t){case"weighing":return"bg-blue-50 text-blue-600";case"meal":return"bg-green-50 text-green-600";case"immunization":return"bg-purple-50 text-purple-600";default:return"bg-gray-50 text-gray-600"}},R=t=>{switch(t){case"weighing":return"Penimbangan";case"meal":return"Log Makanan";case"immunization":return"Imunisasi";default:return t}},B=t=>{const{type:a,datetime:r,child_name:c,data:l}=t;return e.createElement("div",{key:`${a}-${t.id}`,className:"group bg-white border-b border-gray-100 hover:bg-gray-50 transition-colors duration-200"},e.createElement("div",{className:"px-4 md:px-8 py-4 flex flex-col md:flex-row md:items-center gap-4"},e.createElement("div",{className:"flex items-center gap-4 min-w-[200px]"},e.createElement("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-lg ${O(a)}`},J(a)),e.createElement("div",null,e.createElement("p",{className:"font-semibold text-gray-900"},R(a)),e.createElement("p",{className:"text-xs text-gray-500 truncate max-w-[150px]"},c||"Anak"))),e.createElement("div",{className:"flex-1 text-sm text-gray-600"},a==="weighing"&&e.createElement("div",{className:"flex flex-wrap gap-x-6 gap-y-1"},e.createElement("span",null,"Berat: ",e.createElement("span",{className:"font-medium text-gray-900"},l.weight_kg??"-"," ",l.weight_kg?"kg":"")),l.height_cm&&e.createElement("span",null,"Tinggi: ",e.createElement("span",{className:"font-medium text-gray-900"},l.height_cm," cm")),l.nutritional_status&&e.createElement("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium border ${W(l.nutritional_status)}`},Y(l.nutritional_status))),a==="meal"&&e.createElement("div",{className:"space-y-1"},e.createElement("p",{className:"truncate max-w-md"},e.createElement("span",{className:"font-medium text-gray-900"},l.time_of_day)," - ",l.description||"Tidak ada deskripsi"),l.ingredients&&e.createElement("p",{className:"text-xs text-gray-500 truncate max-w-md"},l.ingredients)),a==="immunization"&&e.createElement("div",null,e.createElement("p",{className:"font-medium text-gray-900"},l.title),l.scheduled_for&&e.createElement("p",{className:"text-xs text-gray-500"},"Jadwal: ",S(l.scheduled_for))),l.notes&&e.createElement("p",{className:"text-xs text-gray-400 mt-1 italic line-clamp-1"},l.notes)),e.createElement("div",{className:"text-right min-w-[120px]"},e.createElement("p",{className:"text-sm font-medium text-gray-900"},S(r).split(" ").slice(0,2).join(" ")),e.createElement("p",{className:"text-xs text-gray-400"},new Date(r).getFullYear()," â€¢ ",new Date(r).getHours().toString().padStart(2,"0"),":",new Date(r).getMinutes().toString().padStart(2,"0")))))};return p&&u.length===0?e.createElement("div",{className:"w-full h-full bg-white"},e.createElement(K,null)):y&&u.length===0?e.createElement("div",{className:"flex flex-col w-full h-full bg-white"},e.createElement("div",{className:"px-4 pt-5 md:px-10 md:pt-10 pb-4"},e.createElement(T,{title:"Riwayat",subtitle:"Portal Orang Tua"})),e.createElement("div",{className:"flex-1 flex items-center justify-center p-4"},e.createElement("div",{className:"text-center"},e.createElement("p",{className:"text-red-600 mb-2"},y),e.createElement("button",{onClick:()=>g(n.current_page),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"},"Coba Lagi")))):e.createElement("div",{className:"flex flex-col w-full h-full bg-white overflow-hidden"},e.createElement("div",{className:"relative z-50"},e.createElement(T,{title:"Riwayat",subtitle:"Portal Orang Tua"})),e.createElement("div",{className:"px-4 py-4 md:px-10 bg-white z-40 border-b border-gray-100"},e.createElement("div",{className:"flex flex-col md:flex-row gap-3 items-center justify-between"},e.createElement("div",{className:"flex items-center gap-2 w-full md:w-auto overflow-x-auto no-scrollbar pb-2 md:pb-0"},e.createElement(I,null,e.createElement($,{asChild:!0},e.createElement("button",{className:"flex items-center gap-2 px-4 py-2 bg-gray-50 hover:bg-gray-100 rounded-full text-sm font-medium text-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-100"},e.createElement(w,{icon:"lucide:users",className:"text-gray-500 w-4 h-4"}),e.createElement("span",{className:"truncate max-w-[120px]"},s.child_id&&x.find(t=>t.id==s.child_id)?.full_name||"Semua Anak"),e.createElement(w,{icon:"lucide:chevron-down",className:"text-gray-400 w-4 h-4 ml-1"}))),e.createElement(j,{align:"start",className:"w-56 bg-white rounded-xl shadow-xl border border-gray-100 p-1"},e.createElement(d,{onClick:()=>o("child_id",""),className:"rounded-lg cursor-pointer hover:bg-gray-50 focus:bg-gray-50"},e.createElement("span",{className:"font-medium"},"Semua Anak")),x.length===0&&_&&e.createElement("div",{className:"px-3 py-2 text-xs text-red-600"},_),x.map(t=>e.createElement(d,{key:t.id,onClick:()=>o("child_id",t.id),className:"rounded-lg cursor-pointer hover:bg-gray-50 focus:bg-gray-50 gap-2"},e.createElement("div",{className:"w-6 h-6 rounded-full bg-blue-100 flex items-center justify-center text-xs text-blue-600 font-bold"},(t.full_name||"?")[0]),e.createElement("span",{className:"truncate"},t.full_name||"Nama Anak"))))),e.createElement(I,null,e.createElement($,{asChild:!0},e.createElement("button",{className:"flex items-center gap-2 px-4 py-2 bg-gray-50 hover:bg-gray-100 rounded-full text-sm font-medium text-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-100"},e.createElement("span",null,s.type==="all"&&"Semua Tipe",s.type==="weighing"&&"âš–ï¸ Penimbangan",s.type==="meal"&&"ðŸ½ï¸ Makanan",s.type==="immunization"&&"ðŸ’‰ Imunisasi"),e.createElement(w,{icon:"lucide:chevron-down",className:"text-gray-400 w-4 h-4 ml-1"}))),e.createElement(j,{align:"start",className:"w-48 bg-white rounded-xl shadow-xl border border-gray-100 p-1"},e.createElement(d,{onClick:()=>o("type","all"),className:"rounded-lg cursor-pointer hover:bg-gray-50 focus:bg-gray-50 font-medium"},"Semua Tipe"),e.createElement(d,{onClick:()=>o("type","weighing"),className:"rounded-lg cursor-pointer hover:bg-gray-50 focus:bg-gray-50 gap-2"},e.createElement("span",null,"âš–ï¸")," Penimbangan"),e.createElement(d,{onClick:()=>o("type","meal"),className:"rounded-lg cursor-pointer hover:bg-gray-50 focus:bg-gray-50 gap-2"},e.createElement("span",null,"ðŸ½ï¸")," Makanan"),e.createElement(d,{onClick:()=>o("type","immunization"),className:"rounded-lg cursor-pointer hover:bg-gray-50 focus:bg-gray-50 gap-2"},e.createElement("span",null,"ðŸ’‰")," Imunisasi")))),e.createElement("div",{className:"flex items-center gap-2 w-full md:w-auto flex-wrap md:flex-nowrap"},e.createElement("div",{className:"flex items-center gap-2 flex-1 md:flex-none"},e.createElement(z,{value:s.start_date,onChange:t=>o("start_date",t),placeholder:"Mulai",className:"w-full md:w-auto"}),e.createElement("span",{className:"text-gray-300"},"-"),e.createElement(z,{value:s.end_date,onChange:t=>o("end_date",t),placeholder:"Selesai",className:"w-full md:w-auto"}))))),e.createElement("div",{className:"flex-1 overflow-auto bg-white [&::-webkit-scrollbar]:hidden [-ms-overflow-style:'none'] [scrollbar-width:'none']"},u.length===0?e.createElement("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400"},e.createElement("div",{className:"text-4xl mb-3"},"ðŸ“­"),e.createElement("p",null,"Tidak ada riwayat ditemukan")):e.createElement("div",{className:"divide-y divide-gray-50"},u.map(t=>B(t))),n.last_page>1&&e.createElement("div",{className:"py-6 flex flex-col items-center gap-3"},e.createElement("div",{className:"flex items-center gap-2"},e.createElement("button",{onClick:()=>h(n.current_page-1),disabled:n.current_page===1,className:"px-4 py-2 bg-white border border-gray-200 rounded-xl hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-sm disabled:hover:bg-white"},e.createElement("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"}))),e.createElement("div",{className:"flex items-center gap-2"},[...Array(n.last_page)].map((t,a)=>{const r=a+1,c=r===n.current_page;return r===1||r===n.last_page||r>=n.current_page-1&&r<=n.current_page+1?e.createElement("button",{key:r,onClick:()=>h(r),className:`min-w-[40px] h-10 rounded-xl font-medium transition-all ${c?"bg-blue-600 text-white shadow-lg shadow-blue-600/30":"bg-white border border-gray-200 text-gray-700 hover:bg-gray-50 shadow-sm"}`},r):r===n.current_page-2||r===n.current_page+2?e.createElement("span",{key:r,className:"px-2 text-gray-400"},"..."):null})),e.createElement("button",{onClick:()=>h(n.current_page+1),disabled:n.current_page===n.last_page,className:"px-4 py-2 bg-white border border-gray-200 rounded-xl hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-sm disabled:hover:bg-white"},e.createElement("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})))),e.createElement("div",{className:"text-sm text-gray-500 bg-white/50 px-4 py-2 rounded-xl border border-gray-100"},"Halaman ",n.current_page," dari ",n.last_page," â€¢ Total: ",e.createElement("span",{className:"font-bold text-gray-900"},n.total)," riwayat"))))}export{Q as default};
