import{R as e,S as o,u as M,p as K,r as l,b as x,af as N,m as k,N as L,am as I,V as B,y as F,aa as P,an as j}from"./app-2DBIoE10.js";function D({fieldCount:i=8}){return e.createElement("div",{className:"flex flex-1 w-full h-full overflow-auto"},e.createElement("div",{className:"p-4 md:p-10 w-full h-full bg-gray-50 flex flex-col gap-6"},e.createElement("div",{className:"mb-2"},e.createElement(o,{className:"h-9 w-64 mb-3"}),e.createElement(o,{className:"h-5 w-96",variant:"text"})),e.createElement("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200 max-w-2xl"},e.createElement("div",{className:"space-y-6"},Array.from({length:i}).map((d,b)=>e.createElement("div",{key:b},e.createElement(o,{className:"h-4 w-32 mb-2",variant:"text"}),e.createElement(o,{className:"h-10 w-full"}))),e.createElement("div",{className:"flex gap-3 pt-4"},e.createElement(o,{className:"h-10 w-24"}),e.createElement(o,{className:"h-10 w-32"}))))))}function G(){const i=M(),{invalidateCache:d}=K(),[b,E]=l.useState(!0),[r,g]=l.useState(!1),[v,s]=l.useState(null),[u,y]=l.useState([]),[p,w]=l.useState([]),[f,C]=l.useState(""),[n,S]=l.useState(""),[h,c]=l.useState("");l.useEffect(()=>{_()},[]);const _=async()=>{try{E(!0),s(null);const[t,a]=await Promise.all([x.get("/parent/children"),x.get("/parent/kaders")]);y(t.data.data),w(a.data.data)}catch(t){const a=t.response?.data?.message||"Gagal memuat data. Silakan coba lagi.";s(a),console.error("Fetch error:",t)}finally{E(!1)}};l.useEffect(()=>{if(n&&u.length>0&&p.length>0){const t=u.find(a=>a.id===parseInt(n));if(t&&t.posyandu_id){const a=p.find(m=>m.posyandu_id===t.posyandu_id);c(a?a.id:"")}else c("")}else n||c("")},[n,u,p]);const A=async t=>{if(t.preventDefault(),!f.trim()){s("Judul konsultasi harus diisi.");return}try{g(!0),s(null);const a={title:f.trim()};n&&(a.child_id=parseInt(n)),h&&(a.kader_id=parseInt(h));const m=await x.post("/parent/consultations",a);d("consultations_all"),d("consultations_open"),d("consultations_closed"),i(`/dashboard/konsultasi/${m.data.data.id}`)}catch(a){if(a.response?.status===403)s("Anda tidak memiliki akses untuk membuat konsultasi.");else{const m=a.response?.data?.message||"Gagal membuat konsultasi. Silakan coba lagi.";s(m)}console.error("Create consultation error:",a)}finally{g(!1)}};return b?e.createElement(D,{fieldCount:3}):e.createElement("div",{className:"flex flex-col h-full bg-slate-50 overflow-y-auto"},e.createElement("div",{className:"bg-white border-b border-slate-200 px-6 py-4 sticky top-0 z-10 shadow-sm"},e.createElement("div",{className:"max-w-2xl mx-auto w-full flex items-center gap-4"},e.createElement("button",{onClick:()=>i("/dashboard/konsultasi"),className:"p-2 -ml-2 hover:bg-slate-100 rounded-full transition-colors text-slate-600"},e.createElement(N,{className:"w-5 h-5"})),e.createElement("div",null,e.createElement("h1",{className:"text-lg font-bold text-slate-800"},"Buat Konsultasi Baru"),e.createElement("p",{className:"text-xs text-slate-500"},"Mulai percakapan dengan kader")))),e.createElement("div",{className:"flex-1 p-4 md:p-8"},e.createElement("div",{className:"max-w-2xl mx-auto w-full"},v&&e.createElement(k.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"bg-red-50 border border-red-200 rounded-xl p-4 flex items-start gap-3 mb-6"},e.createElement(L,{className:"w-5 h-5 text-red-600 flex-shrink-0 mt-0.5"}),e.createElement("div",{className:"flex-1"},e.createElement("p",{className:"text-red-800 text-sm font-medium"},v)),e.createElement("button",{onClick:()=>s(null),className:"text-red-400 hover:text-red-600 transition-colors"},e.createElement("span",{className:"sr-only"},"Dismiss"),e.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})))),e.createElement(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white rounded-2xl p-6 md:p-8 shadow-sm border border-slate-200"},e.createElement("form",{onSubmit:A,className:"space-y-6"},e.createElement("div",null,e.createElement("label",{htmlFor:"title",className:"block text-sm font-semibold text-slate-700 mb-2"},"Topik Konsultasi ",e.createElement("span",{className:"text-red-500"},"*")),e.createElement("div",{className:"relative"},e.createElement("div",{className:"absolute left-4 top-3.5 text-slate-400"},e.createElement(I,{className:"w-5 h-5"})),e.createElement("input",{type:"text",id:"title",value:f,onChange:t=>C(t.target.value),placeholder:"Contoh: Pertanyaan tentang MPASI...",className:"w-full pl-12 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-slate-800 placeholder:text-slate-400",required:!0,disabled:r,maxLength:255})),e.createElement("p",{className:"mt-2 text-xs text-slate-500"},"Jelaskan secara singkat apa yang ingin Anda tanyakan.")),e.createElement("div",null,e.createElement("label",{htmlFor:"child",className:"block text-sm font-semibold text-slate-700 mb-2"},"Terkait Anak (Opsional)"),e.createElement("div",{className:"relative"},e.createElement("div",{className:"absolute left-4 top-3.5 text-slate-400"},e.createElement(B,{className:"w-5 h-5"})),e.createElement("select",{id:"child",value:n,onChange:t=>S(t.target.value),className:"w-full pl-12 pr-10 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-slate-800 appearance-none",disabled:r},e.createElement("option",{value:""},"-- Pilih Anak --"),u.map(t=>e.createElement("option",{key:t.id,value:t.id},t.full_name," (",F(t.age_in_months),")"))),e.createElement("div",{className:"absolute right-4 top-3.5 pointer-events-none text-slate-400"},e.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})))),e.createElement("p",{className:"mt-2 text-xs text-slate-500 flex items-center gap-1"},e.createElement(P,{className:"w-3 h-3 text-green-500"}),"Kader akan otomatis disesuaikan dengan posyandu anak, namun Anda dapat mengubahnya.")),e.createElement("div",null,e.createElement("label",{htmlFor:"kader",className:"block text-sm font-semibold text-slate-700 mb-2"},"Pilih Kader"),e.createElement("div",{className:"relative"},e.createElement("div",{className:"absolute left-4 top-3.5 text-slate-400"},e.createElement(j,{className:"w-5 h-5"})),e.createElement("select",{id:"kader",value:h,onChange:t=>c(t.target.value),className:"w-full pl-12 pr-10 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-slate-800 appearance-none",disabled:r},e.createElement("option",{value:""},"-- Pilih Kader --"),p.map(t=>e.createElement("option",{key:t.id,value:t.id},t.name," ",t.posyandu?`(${t.posyandu.name})`:""," ",t.is_online?"ðŸŸ¢ Online":""))),e.createElement("div",{className:"absolute right-4 top-3.5 pointer-events-none text-slate-400"},e.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})))),e.createElement("p",{className:"mt-2 text-xs text-slate-500"},"Pilih kader yang ingin Anda ajak berkonsultasi.")),e.createElement("div",{className:"pt-4 flex gap-3"},e.createElement("button",{type:"button",onClick:()=>i("/dashboard/konsultasi"),className:"px-6 py-3 border border-slate-200 text-slate-600 rounded-xl hover:bg-slate-50 transition-colors font-medium",disabled:r},"Batal"),e.createElement("button",{type:"submit",disabled:r,className:"flex-1 px-6 py-3 bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-all shadow-lg shadow-blue-200 hover:shadow-blue-300 transform active:scale-95 font-medium disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"},r?e.createElement(e.Fragment,null,e.createElement("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),e.createElement("span",null,"Memproses...")):e.createElement(e.Fragment,null,e.createElement("span",null,"Mulai Konsultasi"),e.createElement(N,{className:"w-5 h-5 rotate-180"})))))))))}export{G as default};
