import{u as L,M as S,r as i,b as g,R as e}from"./app-2DBIoE10.js";function j(){const m=L(),{id:d}=S(),[y,f]=i.useState(!0),[c,k]=i.useState(!1),[_,u]=i.useState(null),[E,N]=i.useState([]),[t,x]=i.useState({full_name:"",nik:"",birth_date:"",gender:"",posyandu_id:"",birth_weight_kg:"",birth_height_cm:"",notes:"",is_active:!0}),[n,h]=i.useState({});i.useEffect(()=>{w(),v()},[d]);const w=async()=>{try{const a=await g.get("/posyandus");N(a.data.data||a.data)}catch(a){console.error("Failed to fetch posyandus:",a)}},v=async()=>{try{f(!0);const r=(await g.get(`/children/${d}`)).data.data;x({full_name:r.full_name||"",nik:r.nik||"",birth_date:r.birth_date||"",gender:r.gender||"",posyandu_id:r.posyandu_id||"",birth_weight_kg:r.birth_weight_kg||"",birth_height_cm:r.birth_height_cm||"",notes:r.notes||"",is_active:r.is_active??!0})}catch(a){console.error("Failed to fetch child data:",a),u(a.response?.data?.message||"Gagal memuat data anak")}finally{f(!1)}},l=a=>{const{name:r,value:s,type:b,checked:o}=a.target;x(p=>({...p,[r]:b==="checkbox"?o:s})),n[r]&&h(p=>({...p,[r]:null}))},F=()=>{const a={},r=t.full_name.trim();if(r?r.length<2&&(a.full_name="Nama minimal 2 karakter"):a.full_name="Nama lengkap wajib diisi",t.nik){const s=t.nik.trim();/^\d{16}$/.test(s)||(a.nik="NIK harus 16 digit angka")}if(!t.birth_date)a.birth_date="Tanggal lahir wajib diisi";else{const s=new Date(t.birth_date),b=new Date,o=new Date;o.setFullYear(o.getFullYear()-18),s>b?a.birth_date="Tanggal lahir tidak boleh di masa depan":s<o&&(a.birth_date="Usia anak melebihi batas maksimal (18 tahun)")}return t.gender||(a.gender="Jenis kelamin wajib dipilih"),t.birth_weight_kg&&(parseFloat(t.birth_weight_kg)<0||parseFloat(t.birth_weight_kg)>10)&&(a.birth_weight_kg="Berat lahir harus antara 0-10 kg"),t.birth_height_cm&&(parseFloat(t.birth_height_cm)<0||parseFloat(t.birth_height_cm)>100)&&(a.birth_height_cm="Tinggi lahir harus antara 0-100 cm"),h(a),Object.keys(a).length===0},C=async a=>{if(a.preventDefault(),!!F()){k(!0),u(null);try{const r={full_name:t.full_name.trim(),nik:t.nik?t.nik.trim():null,birth_date:t.birth_date,gender:t.gender,birth_weight_kg:t.birth_weight_kg?parseFloat(t.birth_weight_kg):null,birth_height_cm:t.birth_height_cm?parseFloat(t.birth_height_cm):null,notes:t.notes?t.notes.trim():null,is_active:t.is_active};await g.put(`/children/${d}`,r),m("/dashboard/anak",{state:{message:"Data anak berhasil diperbarui!"}})}catch(r){console.error("Submit error:",r),r.response?.data?.errors?h(r.response.data.errors):u(r.response?.data?.message||"Gagal memperbarui data anak. Silakan coba lagi.")}finally{k(!1)}}},D=async()=>{if(confirm("Apakah Anda yakin ingin menonaktifkan data anak ini?"))try{await g.delete(`/children/${d}`),m("/dashboard/anak",{state:{message:"Data anak berhasil dinonaktifkan!"}})}catch(a){console.error("Delete error:",a),u(a.response?.data?.message||"Gagal menonaktifkan data anak")}};return y?e.createElement("div",{className:"flex flex-1 w-full h-full overflow-auto"},e.createElement("div",{className:"p-4 md:p-10 w-full h-full bg-gray-50 flex flex-col gap-4"},e.createElement("div",{className:"flex items-center justify-center h-64"},e.createElement("div",{className:"text-center"},e.createElement("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.createElement("p",{className:"text-gray-600"},"Memuat data anak..."))))):e.createElement("div",{className:"flex flex-1 w-full h-full overflow-auto"},e.createElement("div",{className:"p-4 md:p-10 w-full h-full bg-gray-50 flex flex-col gap-6"},e.createElement(PageHeader,{title:"Edit Data Anak",subtitle:"Portal Orang Tua"},e.createElement("button",{onClick:()=>m("/dashboard/anak"),className:"p-2 hover:bg-gray-200 rounded-lg transition-colors"},e.createElement("svg",{className:"w-6 h-6 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})))),_&&e.createElement("div",{className:"bg-red-50 border border-red-200 text-red-800 px-4 py-3 rounded-lg"},e.createElement("div",{className:"flex items-center gap-2"},e.createElement("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20"},e.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})),e.createElement("span",null,_))),e.createElement("form",{onSubmit:C,className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6"},e.createElement("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6"},e.createElement("div",{className:"md:col-span-2"},e.createElement("label",{htmlFor:"full_name",className:"block text-sm font-medium text-gray-700 mb-2"},"Nama Lengkap ",e.createElement("span",{className:"text-red-500"},"*")),e.createElement("input",{type:"text",id:"full_name",name:"full_name",value:t.full_name,onChange:l,className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${n.full_name?"border-red-500":"border-gray-300"}`,placeholder:"Masukkan nama lengkap anak"}),n.full_name&&e.createElement("p",{className:"mt-1 text-sm text-red-600"},n.full_name)),e.createElement("div",null,e.createElement("label",{htmlFor:"nik",className:"block text-sm font-medium text-gray-700 mb-2"},"NIK (Opsional)"),e.createElement("input",{type:"text",id:"nik",name:"nik",value:t.nik,onChange:l,maxLength:"16",pattern:"[0-9]*",inputMode:"numeric",className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${n.nik?"border-red-500":"border-gray-300"}`,placeholder:"Masukkan 16 digit NIK"}),n.nik&&e.createElement("p",{className:"mt-1 text-sm text-red-600"},n.nik)),e.createElement("div",null,e.createElement("label",{htmlFor:"birth_date",className:"block text-sm font-medium text-gray-700 mb-2"},"Tanggal Lahir ",e.createElement("span",{className:"text-red-500"},"*")),e.createElement("input",{type:"date",id:"birth_date",name:"birth_date",value:t.birth_date,onChange:l,max:new Date().toISOString().split("T")[0],min:new Date(new Date().setFullYear(new Date().getFullYear()-18)).toISOString().split("T")[0],className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${n.birth_date?"border-red-500":"border-gray-300"}`}),n.birth_date&&e.createElement("p",{className:"mt-1 text-sm text-red-600"},n.birth_date)),e.createElement("div",null,e.createElement("label",{htmlFor:"gender",className:"block text-sm font-medium text-gray-700 mb-2"},"Jenis Kelamin ",e.createElement("span",{className:"text-red-500"},"*")),e.createElement("select",{id:"gender",name:"gender",value:t.gender,onChange:l,className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${n.gender?"border-red-500":"border-gray-300"}`},e.createElement("option",{value:""},"Pilih jenis kelamin"),e.createElement("option",{value:"L"},"Laki-laki"),e.createElement("option",{value:"P"},"Perempuan")),n.gender&&e.createElement("p",{className:"mt-1 text-sm text-red-600"},n.gender)),e.createElement("div",null,e.createElement("label",{htmlFor:"posyandu_id",className:"block text-sm font-medium text-gray-700 mb-2"},"Posyandu"),e.createElement("select",{id:"posyandu_id",name:"posyandu_id",value:t.posyandu_id,disabled:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100 cursor-not-allowed"},e.createElement("option",{value:""},"Pilih posyandu"),E.map(a=>e.createElement("option",{key:a.id,value:a.id},a.name))),e.createElement("p",{className:"mt-1 text-xs text-gray-500"},"Posyandu tidak dapat diubah")),e.createElement("div",null,e.createElement("label",{htmlFor:"birth_weight_kg",className:"block text-sm font-medium text-gray-700 mb-2"},"Berat Lahir (kg)"),e.createElement("input",{type:"number",id:"birth_weight_kg",name:"birth_weight_kg",value:t.birth_weight_kg,onChange:l,step:"0.1",min:"0",max:"10",className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${n.birth_weight_kg?"border-red-500":"border-gray-300"}`,placeholder:"Contoh: 3.2"}),n.birth_weight_kg&&e.createElement("p",{className:"mt-1 text-sm text-red-600"},n.birth_weight_kg)),e.createElement("div",null,e.createElement("label",{htmlFor:"birth_height_cm",className:"block text-sm font-medium text-gray-700 mb-2"},"Tinggi Lahir (cm)"),e.createElement("input",{type:"number",id:"birth_height_cm",name:"birth_height_cm",value:t.birth_height_cm,onChange:l,step:"0.1",min:"0",max:"100",className:`w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${n.birth_height_cm?"border-red-500":"border-gray-300"}`,placeholder:"Contoh: 48.5"}),n.birth_height_cm&&e.createElement("p",{className:"mt-1 text-sm text-red-600"},n.birth_height_cm)),e.createElement("div",{className:"md:col-span-2"},e.createElement("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 mb-2"},"Catatan (Opsional)"),e.createElement("textarea",{id:"notes",name:"notes",value:t.notes,onChange:l,rows:"3",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",placeholder:"Tambahkan catatan jika diperlukan"})),e.createElement("div",{className:"md:col-span-2"},e.createElement("label",{className:"flex items-center gap-2 cursor-pointer"},e.createElement("input",{type:"checkbox",name:"is_active",checked:t.is_active,onChange:l,className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.createElement("span",{className:"text-sm font-medium text-gray-700"},"Data anak aktif")),e.createElement("p",{className:"mt-1 text-xs text-gray-500 ml-6"},"Nonaktifkan jika anak sudah tidak terdaftar di posyandu"))),e.createElement("div",{className:"flex justify-between items-center mt-6 pt-6 border-t border-gray-200"},e.createElement("button",{type:"button",onClick:D,className:"px-6 py-2 border border-red-300 text-red-600 rounded-lg hover:bg-red-50 transition-colors",disabled:c},"Nonaktifkan"),e.createElement("div",{className:"flex gap-3"},e.createElement("button",{type:"button",onClick:()=>m("/dashboard/anak"),className:"px-6 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors",disabled:c},"Batal"),e.createElement("button",{type:"submit",disabled:c,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-blue-400 disabled:cursor-not-allowed flex items-center gap-2"},c?e.createElement(e.Fragment,null,e.createElement("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),"Menyimpan..."):e.createElement(e.Fragment,null,e.createElement("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},e.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})),"Simpan Perubahan")))))))}export{j as default};
